@using ApexCharts
@using UxTracker.Web.Components.Skeletons
@using UxTracker.Web.Components.Forms
@using UxTracker.Web.Components.Relatories

@page "/reviewers/research/{ProjectId:guid}"
@inherits Review

<AuthorizeView Roles="Reviewer">
    <Authorized>
        <MudContainer
            MaxWidth="MaxWidth.Medium"
            Class="d-flex flex-column justify-center align-center gap-10 pt-14 h-full r-container">
            <MudPaper
                Class="d-flex flex-column align-center gap-10 pa-8 rounded-lg w-full r-paper"
                Outlined="true">
                @if (!IsBusy)
                {
                    <MudText
                        Typo="Typo.h4"
                        Align="MudBlazor.Align.Center"
                        Class="r-container-title">
                        @Response.Data.Project.Title
                    </MudText>
               
                    <MudText Typo="Typo.body1">
                        @Response.Data.Project.Description
                    </MudText>
                    
                    <MudDivider DividerType="DividerType.Middle"/>

                    <MudText
                        Typo="Typo.h5"
                        Align="MudBlazor.Align.Center">
                        Acompanhamento da Avaliação
                    </MudText>
                    
                    <ReviewMonitoring 
                        Rates="Response.Data.Project.Reviews" 
                        SurveyCollections="Response.Data.Project.SurveyCollections" 
                        PeriodType="Response.Data.Project.PeriodType"/>
                    
                    <ValidateForm
                        SubmitFunction="HandleSubmit"
                        TextButton="Enviar"
                        ButtonClass="h-full px-8"
                        Class="d-flex flex-row gap-3 w-full">
                        <MudGrid
                            Spacing="3"
                            Class="w-full">
                            <MudItem xs="12" md="2">
                                <MudNumericField
                                    T="decimal"
                                    Label="Nota"
                                    Variant="Variant.Filled"
                                    Min="0"
                                    Max="10"
                                    Step=".1M"
                                    Format="F1"
                                    @bind-Value="RatingRequest.Rating"
                                    Required="true"
                                    RequiredError="Informe a nota"/>
                            </MudItem>
                            
                            <MudItem xs="12" md="10">
                                <MudTextField 
                                    T="string" 
                                    Label="Comentário" 
                                    Variant="Variant.Filled" 
                                    FullWidth="true" 
                                    @bind-Value="RatingRequest.Comment"/>
                            </MudItem>
                        </MudGrid>
                    </ValidateForm>
                }
                else
                {
                    <ResearchTitleSkeleton/>
                    <ResearchDescriptionSkeleton/>
                    <ResearchFormSkeleton/>
                }
            </MudPaper>
        </MudContainer>
    </Authorized>

    <NotAuthorized>
        <RedirectToUnauthorizedPage/>
    </NotAuthorized>
</AuthorizeView>